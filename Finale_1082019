#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>
#include <time.h>
#include <Windows.h>
#include "iGraphics.h"

int ara[2000];
int p1=0;
int p2=790;
int isballstarted=0;
int px,py;
int ball_x=100;
int ball_y=20;
int dx=7;
int dy=5;
int rad=10;
int stick_x=60;
int stick_y=0;
int stick_len=80;
int stick_wi=10;
int score;
int i,j,xx,yy;
int colour;
char update[800];


void iDraw()
{
    iClear();
    iShowBMP(0,0,"mosaic.bmp");
    sprintf(update,"Score : %d",score);
    iSetColor(255,255,255);
    iText(0,800,"DX BALL by SACHIN & SAMEE",GLUT_BITMAP_HELVETICA_18);
    iSetColor(0,255,255);
    iText(600,800,update,GLUT_BITMAP_HELVETICA_18);
    iSetColor(255,0,0);
    iFilledCircle(ball_x,ball_y,rad);
    iSetColor(255,255,51);
    iFilledRectangle(stick_x,stick_y,stick_len,stick_wi);

    yy=p2;
    colour=0;
        for(i=0;i<40;i++)//row
        {
            xx=p1;
            for(j=0;j<40;j++)//column
            {
                if(colour<=10) iSetColor(153,51,255);
                else if(colour<=20) iSetColor(130,20,226);
                else if(colour<=30) iSetColor(56,31,155);
                else if(colour<=40) iSetColor(30,122,243);
                if(ara[(40-i)*40+j]==0)
                iFilledRectangle(xx,yy,20,5);
                xx+=20;
            }
            yy-=5;
            colour++;
        }
}


void ballchange()
{
    if(isballstarted==1)
    {
       ball_x+=dx;
       ball_y+=dy;

       if(ball_y>600)
          {
              if(ara[((ball_y-600)/5)*40+(ball_x/20)]==0)
           {
                   ara[((ball_y-600)/5)*40+(ball_x/20)]=1;
                   score++;
                   if(dy>0) dy=-dy;
           }
          }
       if(ball_x>=800||ball_x<0)
        dx=-dx;
        if(ball_y>813) dy=-dy;
        if(ball_y>=800)
        dy=-dy;
        if(ball_x>=stick_x&&ball_x<=stick_x+stick_len&&ball_y==stick_y+stick_wi)
        {
            dy=-dy;
            if(ball_x<=stick_x+stick_len/2) dx=-dx;
        }
        else
        {
            if(ball_y<stick_y){
                printf("\n\nYour score is ... ... %d\n\n",score);
                exit(0);
            }

        }
        }
    }


void iMouseMove(int mx, int my)
{

}


void iMouse(int button, int state, int mx, int my)
{
    if(button == GLUT_LEFT_BUTTON && state == GLUT_DOWN)
    {

    }
    if(button == GLUT_RIGHT_BUTTON && state == GLUT_DOWN)
    {

    }
}

void iKeyboard(unsigned char key)
{
    if(key == 'p')
    {
        iPauseTimer(0);
    }
    if(key == 'r')
    {
        iResumeTimer(0);
    }
    if(key==' ')
        isballstarted=1;
}


void iSpecialKeyboard(unsigned char key)
{

    if(key == GLUT_KEY_END)
    {
        exit(0);
    }
    if(key == GLUT_KEY_LEFT)
    {
        if(stick_x>0)
       {
        stick_x-=15;
        if(isballstarted==0)
            ball_x-=15;
       }
    }
    if(key == GLUT_KEY_RIGHT)
    {
           if(stick_x<720)
        {
         stick_x+=15;
        if(isballstarted==0)
            ball_x+=15;
        }
    }
}


int main()
{
    PlaySound("F:\\DX Ball\\Action_Sport.wav", NULL, SND_LOOP | SND_ASYNC);
    //mciSendString("C:\KMPlayer\Action_Sport.mp3", NULL, 0, NULL);
    score=0;
    iSetTimer(20,ballchange);
    iInitialize(800,813,"DX_BALL");
    return 0;
}
