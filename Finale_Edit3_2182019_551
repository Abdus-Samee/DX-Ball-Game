#include <stdio.h>

#include <conio.h>

#include <math.h>

#include <stdlib.h>

#include <time.h>

#include <Windows.h>

#include "iGraphics.h"



int ara[2000];

int p1=0;

int p2=790;

int isballstarted=0;

int px,py;

int ball_x=100;

int ball_y=20;

int dx=7;

int dy=5;

int rad=10;

int stick_x=60;

int stick_y=0;

int stick_len=80;

int stick_wi=10;

int score;

int i,j,xx,yy;

int colour;

char update[800];

char finale[800];

int cover;

int clr1=50,clr2=50,clr3=50;

int clr[2000][3];

int rate_x=1;

int rate_y=1;

int option;

void iDraw()

{

    iClear();

    if(cover==0)

    {
        iShowBMP(0,0,"black.bmp");

        iSetColor(0,255,0);

        iRectangle(340,550,130,100);

        iSetColor(255,255,255);

        iText(350,600,"DX  BALL",GLUT_BITMAP_TIMES_ROMAN_24);



        iSetColor(255,223,0);

        iText(320,500,"-by SACHIN & SAMEE",GLUT_BITMAP_HELVETICA_18);

        iSetColor(0,255,255);

        iText(300,300,"PLAY",GLUT_BITMAP_TIMES_ROMAN_24);

        iText(300,260,"RULES",GLUT_BITMAP_TIMES_ROMAN_24);

        iText(300,220,"EXIT",GLUT_BITMAP_TIMES_ROMAN_24);

        iSetColor(0,0,255);

        iFilledCircle(285,310,5);
        iFilledCircle(285,270,5);
        iFilledCircle(285,230,5);

        if(option==1){
            iSetColor(255,255,255);
            iFilledRectangle(290,290,80,40);
            iSetColor(0,0,0);
            iText(300,300,"PLAY",GLUT_BITMAP_TIMES_ROMAN_24);
        }

        if(option==2){
            iSetColor(255,255,255);
            iFilledRectangle(290,250,90,40);
            iSetColor(0,0,0);
            iText(300,260,"RULES",GLUT_BITMAP_TIMES_ROMAN_24);
        }

        if(option==3){
            iSetColor(255,255,255);
            iFilledRectangle(290,210,80,40);
            iSetColor(0,0,0);
            iText(300,220,"EXIT",GLUT_BITMAP_TIMES_ROMAN_24);
        }

    }



    if(cover==1){

        iShowBMP(0,0,"mosaic.bmp");

        sprintf(update,"Score : %d",score);

        iSetColor(255,255,255);

        iText(0,800,"DX BALL by SACHIN & SAMEE",GLUT_BITMAP_HELVETICA_18);

        iSetColor(0,255,255);

        iText(600,800,update,GLUT_BITMAP_HELVETICA_18);

        iSetColor(255,0,0);

        iFilledCircle(ball_x,ball_y,rad);

        iSetColor(255,255,51);

        iFilledRectangle(stick_x,stick_y,stick_len,stick_wi);



        yy=p2;

        colour=0;

            for(i=0;i<40;i++)//row

            {

                xx=p1;

                for(j=0;j<40;j++)//column

                {

                    if(ara[(40-i)*40+j]==0)

                    {
                        iSetColor(clr[(40-i)*40+j][0],clr[(40-i)*40+j][1],clr[(40-i)*40+j][2]);
                        iFilledRectangle(xx,yy,20,5);
                    }

                    xx+=20;

                }

                yy-=5;

                colour++;

            }

        }


    if(cover==2){

        iShowBMP(0,0,"file.bmp");

        iSetColor(0,255,0);

        iRectangle(340,630,130,70);

        iSetColor(255,255,255);

        iText(350,650,"DX  BALL",GLUT_BITMAP_TIMES_ROMAN_24);


        iSetColor(255,255,255);

        iText(245,590,"GAME  IS  OVER !  WELL   PLAYED ! !",GLUT_BITMAP_TIMES_ROMAN_24);

        iSetColor(0,255,0);

        sprintf(finale,"YOUR FINAL SCORE IS  : %d",score);

        iText(250,300,finale,GLUT_BITMAP_TIMES_ROMAN_24);

        iSetColor(0,0,255);

        iText(250,200,"PRESS  'e'  TO EXIT",GLUT_BITMAP_TIMES_ROMAN_24);

    }



    if(cover==3){

        iShowBMP(0,0,"rules.bmp");

        iSetColor(0,0,255);

        iRectangle(290,640,100,50);

        iSetColor(0,0,0);

        iText(300,650," RULES " ,GLUT_BITMAP_TIMES_ROMAN_24);

        iText(250,600,"Press spacebar key to shoot the ball.",GLUT_BITMAP_TIMES_ROMAN_24);

        iText(250,560,"Press  '-->'  and  '<--'  keys to move the bar.",GLUT_BITMAP_TIMES_ROMAN_24);

        iText(250,530,"Press  'p'  to pause the game.",GLUT_BITMAP_TIMES_ROMAN_24);

        iText(250,500,"Press  'r'  to resume the game.",GLUT_BITMAP_TIMES_ROMAN_24);

        iText(250,420,"Press  'b'  to go back.",GLUT_BITMAP_TIMES_ROMAN_24);

        iSetColor(178,190,181);

        iFilledCircle(235,610,5);
        iFilledCircle(235,570,5);
        iFilledCircle(235,540,5);
        iFilledCircle(235,510,5);
    }

}





void ballchange()

{

    if(isballstarted==1)

    {

       if(score > 15) dx=rate_x*10;

       if(score > 30) dy=rate_y*12;

       if(score > 45) stick_len=70;

       ball_x+=dx;

       ball_y+=dy;



       if(ball_y>600)

          {

              if(ara[((ball_y-600)/5)*40+(ball_x/20)]==0)

           {

                   ara[((ball_y-600)/5)*40+(ball_x/20)]=1;

                   score++;

                   if(dy>0) dy=-dy, rate_y*=-1;;

           }

          }

       if(ball_x>790 || ball_x<10)

        dx=-dx, rate_x*=-1;

        if(ball_y>813) dy=-dy, rate_y*=-1;

        if(ball_y>=800)

        dy=-dy, rate_y*=-1;

        if(ball_x>=stick_x&&ball_x<=stick_x+stick_len&&ball_y==stick_y+stick_wi)

        {

            dy=-dy, rate_y*=-1;

            if(ball_x<=stick_x+stick_len/2) dx=-dx, rate_x*=-1;

        }

        else

        {

            if(ball_y<stick_y){

                cover=2;

            }
        }

        }

    }





void iMouseMove(int mx, int my)

{



}





void iMouse(int button, int state, int mx, int my)

{

    if(button == GLUT_LEFT_BUTTON && state == GLUT_DOWN)

    {



    }

    if(button == GLUT_RIGHT_BUTTON && state == GLUT_DOWN)

    {



    }

}



void iKeyboard(unsigned char key)

{
    if(key == 'b')
    {
        cover=0;
    }

    if(key == 'e')

    {

        exit(0);

    }

    if(key == 'p')

    {

        iPauseTimer(0);

    }

    if(key == 'r')

    {

        iResumeTimer(0);

    }

    if(key==' ')

        isballstarted=1;

    if(key == '\r')
    {
        if(option == 1) cover=1;

        else if(option == 2) cover=3;

        else if(option == 3) exit(0);
    }
}





void iSpecialKeyboard(unsigned char key)

{



    if(key == GLUT_KEY_END)

    {

        exit(0);

    }

    if(key == GLUT_KEY_LEFT)

    {

        if(stick_x>0)

       {

        stick_x-=15;

        if(isballstarted==0)

            ball_x-=15;

       }

    }

    if(key == GLUT_KEY_RIGHT)

    {

           if(stick_x<720)

        {

         stick_x+=15;

        if(isballstarted==0)

            ball_x+=15;

        }

    }

    if(key == GLUT_KEY_DOWN)
    {
        if(option != 3) option++;
    }

    if(key ==GLUT_KEY_UP)
    {
        if(option != 1) option--;
    }

}





int main()

{
    PlaySound("F:\\DX Ball\\Action_Sport.wav", NULL, SND_LOOP | SND_ASYNC);
    score=0;
    int i,j;
    for(i=0;i<40;i++)
    {
        for(j=0;j<40;j++)
        {
            clr[i*40+j][0]=clr1;
            clr[i*40+j][1]=clr2;
            clr[i*40+j][2]=clr3;
            clr1=(clr1+100)%256;
            clr2=(clr2+200)%256;
            clr3=(clr3+300)%256;
        }
    }

    iSetTimer(20,ballchange);

    iInitialize(800,813,"DX_BALL");

    return 0;

}




